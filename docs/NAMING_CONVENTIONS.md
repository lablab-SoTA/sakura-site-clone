# 命名規則ドキュメント

このドキュメントでは、階層モデル（Series → Season → Episode → Scene）における命名規則を定義します。

## 概要

階層モデルでは、各エンティティに対して以下の命名規則を厳格に適用します：

- **title_raw**: 元のタイトル（そのまま）
- **title_clean**: 正規化・整理されたタイトル
- **slug**: URL用のスラッグ（英数字とハイフンのみ）

## Series（作品）

### title_raw
- **定義**: 元のタイトルをそのまま保存
- **例**: 
  - `「癒し乃さくら」`
  - `【前編】癒し乃さくら`
  - `癒し乃さくら (完全版)`

### title_clean
- **定義**: 正規化・整理されたタイトル
- **規則**:
  - 全角・半角を統一（全角推奨）
  - 記号を統一（例：「」→""、または削除）
  - 不要な情報を削除（例：「完全版」「前編」などの括弧内テキストを削除）
- **例**:
  - `癒し乃さくら`
  - `癒し乃さくら`

### slug
- **定義**: URL用のスラッグ
- **規則**:
  - 英数字とハイフン（`-`）のみ使用
  - 小文字に統一
  - スペースはハイフンに変換
  - 特殊文字は削除または適切な英字に変換
  - 日本語はローマ字表記に変換（例：さくら → sakura）
- **例**:
  - `iyashi-no-sakura`
  - `yuki-no-kanojo`

## Season（シーズン／章）

### name
- **定義**: シーズン名
- **規則**:
  - 統一された形式を使用（例：「Season 1」「Season 2」または「前編」「後編」）
  - シーズンが無い場合は `season_number = 0` を規約化し、`name` は空文字列または「メイン」などを設定
- **例**:
  - `Season 1`
  - `前編`
  - `後編`
  - `メイン`（シーズンが無い場合）

### slug
- **定義**: URL用のスラッグ
- **規則**:
  - Seriesのslug規則に準拠
  - シーズン番号を含める（例：`season-1`、`zenpen`）
- **例**:
  - `season-1`
  - `zenpen`
  - `main`（シーズンが無い場合）

### season_number
- **定義**: シーズン番号
- **規則**:
  - **シーズンが無い場合は必ず `0` を設定**
  - シーズンがある場合は `1` から開始
- **例**:
  - `0`（シーズンが無い場合）
  - `1`（第1シーズン）
  - `2`（第2シーズン）

## Episode（各話）

### title_raw
- **定義**: 元のエピソードタイトルをそのまま保存
- **例**:
  - `第1話「タイトル」`
  - `Episode 1: Title`
  - `【特別編】タイトル`

### title_clean
- **定義**: 正規化・整理されたエピソードタイトル
- **規則**:
  - 番号や記号を削除
  - タイトルのみを抽出
- **例**:
  - `タイトル`（元：`第1話「タイトル」`）
  - `Title`（元：`Episode 1: Title`）

### episode_number_int
- **定義**: 整数のエピソード番号
- **規則**:
  - 通常のエピソードは連番（1, 2, 3, ...）
  - スペシャルエピソードなども連番で管理
- **例**:
  - `1`, `2`, `3`（通常エピソード）
  - `4`（特別編も連番として扱う）

### episode_number_str
- **定義**: 文字列のエピソード番号（表示用）
- **規則**:
  - 表示形式を統一
  - 形式はプロジェクト全体で統一（例：「第1話」「Episode 1」「1話」）
- **例**:
  - `第1話`
  - `第2話`
  - `SP1`（スペシャルエピソード）
  - `Movie 1`（劇場版）

### episode_type
- **定義**: エピソードタイプ
- **値**:
  - `regular`: 通常のエピソード
  - `ova`: OVA（オリジナルビデオアニメーション）
  - `special`: スペシャルエピソード
  - `movie`: 劇場版
  - `recap`: 総集編
- **規則**:
  - 必ず上記のいずれかを設定
  - デフォルトは `regular`

### slug
- **定義**: URL用のスラッグ
- **規則**:
  - SeriesとSeasonのslug規則に準拠
  - エピソード番号を含める（例：`episode-1`、`ep-1`）
- **例**:
  - `episode-1`
  - `episode-2`
  - `special-1`

## Scene（場面・チャプター）

### name
- **定義**: シーン名
- **規則**:
  - 簡潔で分かりやすい名前
- **例**:
  - `オープニング`
  - `メインストーリー`
  - `エンディング`

### slug
- **定義**: URL用のスラッグ（オプション）
- **規則**:
  - シーンのslugは任意（`null`可）
  - 設定する場合は、Episodeのslug規則に準拠

### scene_number
- **定義**: シーン番号
- **規則**:
  - エピソード内で連番（1, 2, 3, ...）

## スラッグの生成規則

### 一般的なルール
1. **小文字に統一**: すべて小文字に変換
2. **スペースをハイフンに変換**: ` ` → `-`
3. **特殊文字を削除**: 日本語、記号などは削除または適切に変換
4. **連続するハイフンを1つに**: `--` → `-`
5. **先頭・末尾のハイフンを削除**

### 日本語からスラッグへの変換例
- `癒し乃さくら` → `iyashi-no-sakura`
- `雪の彼女` → `yuki-no-kanojo`
- `第1話「タイトル」` → `episode-1-title`

### スラッグ生成の実装例

```typescript
function generateSlug(text: string): string {
  // 1. ローマ字変換（必要に応じてライブラリを使用）
  // 2. 小文字化
  // 3. スペースをハイフンに変換
  // 4. 特殊文字を削除
  // 5. 連続するハイフンを1つに
  // 6. 先頭・末尾のハイフンを削除
  return text
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^a-z0-9-]/g, '')
    .replace(/-+/g, '-')
    .replace(/^-|-$/g, '');
}
```

## データ入力時の注意事項

1. **title_rawは必ず入力**: 元のタイトルを保存
2. **title_cleanは正規化**: 表示用に整理
3. **slugは自動生成推奨**: 手動入力も可能だが、一貫性を保つために自動生成を推奨
4. **season_number = 0**: シーズンが無い場合は必ず `0` を設定
5. **episode_typeは必須**: 必ず適切なタイプを設定

## 例：完全な階層構造

```
Series: 「癒し乃さくら」
  title_raw: 「癒し乃さくら」
  title_clean: 癒し乃さくら
  slug: iyashi-no-sakura
  
  Season 0 (メイン)
    season_number: 0
    name: メイン
    slug: main
    
    Episode 1
      episode_number_int: 1
      episode_number_str: 第1話
      episode_type: regular
      title_raw: 第1話「始まり」
      title_clean: 始まり
      slug: episode-1
      
      Scene 1
        scene_number: 1
        name: オープニング
        slug: opening
```

## 参考資料

- [データベーススキーマ](../supabase-schema.sql)
- [型定義](../lib/types/hierarchy.ts)


